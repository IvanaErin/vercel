<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<title>Staff Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --accent:#6f3fb3;
  --lilac:#b99ff1;
  --muted:#f7f5fb;
}
body { background:var(--muted); }

.sidebar {
  width:220px;
  height:100vh;
  position:fixed;
  background:#fff;
  padding-top:1rem;
  box-shadow:2px 0 5px rgba(0,0,0,.1);
}
.sidebar a {
  display:block;
  padding:.75rem 1rem;
  color:#444;
  text-decoration:none;
  font-weight:500;
}
.sidebar a.active, .sidebar a:hover {
  background:var(--lilac);
  color:#fff;
}
.badge {
  background:var(--accent);
  font-size:12px;
}
.main {
  margin-left:220px;
  padding:2rem;
}
.card { border-radius:12px; }
</style>

</head>

<body>

<div class="sidebar">
  <h4 class="px-3" style="color:var(--accent)">Staff Portal</h4>
  <a class="active">Dashboard</a>
  <a href="/menu_management.html">Menu Management</a>
  <a href="/orders.html">Orders <span class="badge" id="pendingBadge"></span></a>
  <a href="/notifications.html">Notifications <span class="badge" id="notifBadge"></span></a>
  <a href="/sales.html">Sales Overview</a>
  <a href="/login.html" onclick="logout()">Logout</a>
</div>

<div class="main">
  <div class="text-end mb-3">
    Welcome, <b id="staffName">Staff</b>
  </div>

  <!-- STATS -->

  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card p-3">
        <div>Total Sales</div>
        <h2 id="totalSales">₱0.00</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3">
        <div>Pending Orders</div>
        <h2 id="pendingOrders">0</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3">
        <div>Completed Today</div>
        <h2 id="completedToday">0</h2>
      </div>
    </div>
  </div>

  <!-- ORDERS -->

  <div class="card">
    <div class="card-header"><b>Recent Orders</b></div>
    <div class="card-body">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>#</th><th>Customer</th><th>Total</th><th>Status</th><th>Action</th>
          </tr>
        </thead>
        <tbody id="ordersTable"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
const token = localStorage.getItem("staff_token");
if (!token) location.href = "/login.html";

function logout(){
  localStorage.removeItem("staff_token");
}

fetch("/api/staff-dashboard", {
  headers:{ Authorization:"Bearer "+token }
})
.then(r=>r.json())
.then(d=>{
  staffName.textContent = d.staff.username;
  totalSales.textContent = "₱"+d.stats.total_sales.toFixed(2);
  pendingOrders.textContent = d.stats.pending;
  completedToday.textContent = d.stats.completed_today;

  pendingBadge.textContent = d.stats.pending || "";
  notifBadge.textContent = d.stats.notifications || "";

  ordersTable.innerHTML = d.orders.map(o=>`
    <tr>
      <td>${o.id}</td>
      <td>${o.customer}</td>
      <td>₱${o.total.toFixed(2)}</td>
      <td>${o.status}</td>
      <td>
        <a class="btn btn-sm btn-secondary" href="/receipt.html?order_id=${o.id}" target="_blank">Receipt</a>
      </td>
    </tr>
  `).join("");
});
</script>

</body>
</html>

